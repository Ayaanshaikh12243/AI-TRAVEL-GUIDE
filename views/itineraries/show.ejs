<%- include('../partials/header') %>

<div class="pb-3 mb-4 border-bottom d-flex justify-content-between align-items-center">
     <div>
        <h1 class="mb-0"><%= itinerary.title %></h1>
        <p class="lead text-muted mb-0">
            <%= new Date(itinerary.startDate).toDateString() %> to <%= new Date(itinerary.endDate).toDateString() %>
        </p>
     </div>
     <div>
        <a href="/itineraries/<%= itinerary._id %>/edit" class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i> Edit Title</a>
        
        <form action="/itineraries/<%= itinerary._id %>/regenerate" method="POST" class="d-inline">
            <button type="submit" class="btn btn-sm btn-outline-info"><i class="bi bi-arrow-repeat"></i> Re-generate</button>
        </form>

        <form action="/itineraries/<%= itinerary._id %>?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this trip?');">
            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Delete</button>
        </form>
     </div>
</div>

<div class="row g-4">
    <div class="col-lg-8">
        
        <div class="card mb-4">
             <div class="card-body">
                <h5 class="card-title"><i class="bi bi-cash-coin"></i> Estimated Total Budget</h5>
                <p class="card-text fs-4 fw-bold"><%= itinerary.budget %></p>
             </div>
        </div>

        <h2 class="mb-3">Daily Plan</h2>
        <div class="accordion" id="itineraryAccordion">
            <% itinerary.days.forEach((day, index) => { %>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-<%= day.day %>">
                        <button class="accordion-button <%= index === 0 ? '' : 'collapsed' %>" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= day.day %>" aria-expanded="<%= index === 0 ? 'true' : 'false' %>" aria-controls="collapse-<%= day.day %>">
                            <strong>Day <%= day.day %>:</strong> &nbsp; <%= new Date(day.date).toDateString() %>
                        </button>
                    </h2>
                    <div id="collapse-<%= day.day %>" class="accordion-collapse collapse <%= index === 0 ? 'show' : '' %>" aria-labelledby="heading-<%= day.day %>" data-bs-parent="#itineraryAccordion">
                        <div class="accordion-body">
                            
                            <div class="day-plan">
                                <% day.plan.forEach(item => { %>
                                    <div class="plan-item">
                                        <div class="plan-time"><i class="bi bi-clock"></i> <%= item.time %></div>
                                        <div class="plan-place"><i class="bi bi-geo-alt-fill"></i> <%= item.place %></div>
                                        <div class="plan-activity"><%= item.activity %></div>
                                        <div class="plan-details">
                                            <span class="me-3"><i class="bi bi-wallet2"></i> Cost: <%= item.cost %></span>
                                            <span><i class="bi bi-bus-front"></i> Transport: <%= item.transport %></span>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>

                            <% if(day.alternatives && day.alternatives.length > 0) { %>
                                <h6 class="mt-4">Alternative Options:</h6>
                                <ul class="list-group list-group-flush">
                                    <% day.alternatives.forEach(alt => { %>
                                        <li class="list-group-item list-group-item-light"><%= alt %></li>
                                    <% }) %>
                                </ul>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>

    </div>

    <div class="col-lg-4">
        <div class="card ai-reasoning sticky-top" style="top: 80px;">
            <div class="card-body">
                <h5 class="card-title ai-reasoning-title"><i class="bi bi-robot"></i> AI Thinking Process</h5>
                <p class="card-text small text-muted">Here's how I planned your trip:</p>
                <ul class="list-unstyled">
                    <% itinerary.aiReasoning.forEach(reason => { %>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <%= reason %>
                        </li>
                    <% }) %>
                </ul>
            </div>
        </div>
    </div>
</div>


<%- include('../partials/footer') %>